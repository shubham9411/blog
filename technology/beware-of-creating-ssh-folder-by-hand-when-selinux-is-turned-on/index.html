<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Beware of creating $HOME/.ssh folder by hand, when SELinux is turned on &#8211; eLitmus Blog</title>
<meta name="description" content="We learn new things everyday, and we document our learnings here...">

<meta name="keywords" content="SSH, SELinux">

<!-- Twitter Cards -->
  <meta name="twitter:card" content="summary">    
<meta name="twitter:title" content="Beware of creating $HOME/.ssh folder by hand, when SELinux is turned on">
<meta name="twitter:description" content=" If you created $HOME in a non-standard place, and created $HOME/.ssh by hand, SELinux may not like it. To please SELinux, you need to set the right "file context" as described in this post">
<meta name="twitter:site" content="@elitmus">

    
        
            <meta name="twitter:creator" content="@shireeshj">
        
    

    

    

    

    

    

    

    

    




<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://localhost:4000/blog/images/blog_logo_taglinedorange.png"/>
<meta property="og:type" content="article">
<meta property="og:title" content="Beware of creating $HOME/.ssh folder by hand, when SELinux is turned on">
<meta property="og:description" content="If you created $HOME in a non-standard place, and created $HOME/.ssh by hand, SELinux may not like it. To please SELinux, you need to set the right "file context" as described in this post">
<meta property="og:url" content="http://localhost:4000/blog/technology/beware-of-creating-ssh-folder-by-hand-when-selinux-is-turned-on/">

<meta property="og:site_name" content="eLitmus Blog">







<link rel="canonical" href="https://www.elitmus.com/blog/technology/beware-of-creating-ssh-folder-by-hand-when-selinux-is-turned-on/">
<link href="http://localhost:4000/blog/feed.xml" type="application/atom+xml" rel="alternate" title="eLitmus Blog Feed">


	<link rel="author" href="https://plus.google.com/+eLitmus?rel=author">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Icons -->
<!-- apple touch icons -->
<link rel="apple-touch-icon" sizes="57x57" href="http://localhost:4000/blog/images/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/blog/images/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/blog/images/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/blog/images/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="60x60" href="http://localhost:4000/blog/images/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="120x120" href="http://localhost:4000/blog/images/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="76x76" href="http://localhost:4000/blog/images/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="152x152" href="http://localhost:4000/blog/images/apple-touch-icon-152x152.png">
<!-- Favicons default 16x16 -->
<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="http://localhost:4000/blog/favicon.ico">

<!-- Favicons others -->
<link rel="icon" type="image/png" href="http://localhost:4000/blog/images/favicon-196x196.png" sizes="196x196">
<link rel="icon" type="image/png" href="http://localhost:4000/blog/images/favicon-160x160.png" sizes="160x160">
<link rel="icon" type="image/png" href="http://localhost:4000/blog/images/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="http://localhost:4000/blog/images/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="http://localhost:4000/blog/images/favicon-32x32.png" sizes="32x32">

<!-- Icons for Windows 8 Tiles -->
<meta name="msapplication-TileColor" content="#ffffff"/>
<meta name="msapplication-TileImage" content="http://localhost:4000/blog/images/mstile-144x144.png">

<!-- For all browsers -->


<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:600,300,300italic|The+Girl+Next+Door" rel="stylesheet" type="text/css">
<link href='//fonts.googleapis.com/css?family=Source+Code+Pro:300' rel='stylesheet' type='text/css'>

<meta http-equiv="cleartype" content="on">

<!-- bootstrap 4 -->
<link rel="stylesheet" type="text/css" href="http://localhost:4000/blog/assets/css/bootstrap.min.css">

<!-- below css file is used for navbar in individual blogposts -->
<link rel="stylesheet" type="text/css" href="http://localhost:4000/blog/assets/css/main.min.css">

<!-- <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css"> -->

<!-- Optional theme -->
<link rel="stylesheet" type="text/css" href="http://localhost:4000/blog/assets/css/bootstrap-theme.min.css">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Font Awesome -->
<link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="http://localhost:4000/blog/assets/css/font-elitmuslogo.css" />

<link rel="stylesheet" href="http://localhost:4000/blog/assets/css/customize.css">
<link rel="stylesheet" href="http://localhost:4000/blog/assets/css/forkit.css">
</head>

<body id="post">

  <header class="headroom">

	<nav class="navbar navbar-expand-md navbar-dark bg-black fixed-top" role="navigation">

			<a class="navbar-brand" href="/blog/">
				<img src="https://cdn0.elitmus.net/assets/elitmus-only-logo-6efc8a74032179afdb89829a093e05bd05d627dd4354bbd1ff7f4eb5db8a0af8.svg" class="img-logo">
				<span><div class="blog-label">blog</div></span>
			</a>

			<!-- the toggle button -->
			<button type="button" class="navbar-toggler" data-toggle="collapse" data-target=".navbar-collapse">
				<span class="navbar-toggler-icon"></span>
				<span class="sr-only">Toggle navigation</span><!-- only for screen readers -->
			</button>

			<div class="collapse navbar-collapse">
				<ul class="nav navbar-nav mr-auto">

					<!-- first item = dropdown search -->
					<li class="nav-item">
						<div class="dropdown search-box-margin">

						<!--
							<div class="form-inline">
								 

								<input data-toggle="dropdown" placeholder="Search..." id="search-box" class="form-control form-control-sm search-input dropdown-toggle" aria-haspopup="true" aria-expanded="false">


								<div class="dropdown-menu" id="search-dropdown">
	                  				<a role='presentation' class='dropdown-item search-results'> Type more.... </a>
								</div>
							</div>
						-->
            

						<!-- the below line will pass "search word" to search.html -->

						<!--
						<form class="form-inline" action="http://localhost:4000/blog/search" method="get">
							 


							<label for="search_box">Search</label>
							<input data-toggle="dropdown" type="text" name="query" placeholder="Search..." id="search-box" class="form-control form-control-sm search-input dropdown-toggle" aria-haspopup="true" aria-expanded="false">

							<div class="dropdown-menu" id="search-dropdown">
                  				<a role='presentation' class='dropdown-item search-results'> Type more.... </a>
							</div>

							<input type="submit" value="search">

						</form>
						-->

						<!-- end of form -->


						</div>
					</li>
				</ul>

				

				<!-- every link on the right side -->
				<ul class="nav navbar-nav navbar-right nav-icon-size-reduce">
					
					<li class="nav-item">
						 
							<a href="http://localhost:4000/blog/" class="nav-link">
								<i class="fa fa-home"></i> Home
							</a>
						
					</li>
					
					<li class="nav-item">
						 
							<a href="http://localhost:4000/blog/posts/" class="nav-link">
								<i class="fa fa-file-text-o"></i> Posts
							</a>
						
					</li>
					
					<li class="nav-item">
						 
							<a href="//www.elitmus.com/" class="nav-link">
								<i class="el el-elitmuslogo"></i> eLitmus
							</a>
						
					</li>
					

					<!-- feed is the last link -->
					<li class="nav-item">
						<a href="http://localhost:4000/blog/feed.xml" class="nav-link" title="Atom/RSS feed">
							<i class="fa fa-rss"></i> Feed
						</a>
					</li>
				</ul>



			</div> <!-- /.navbar-collapse -->

		<!-- -------- -->
	</nav><!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
</header>
<!-- 

  <div class="search-wrapper">
    <div class="search-form">
      <input type="text" class="search-field" placeholder="Search...">
      <i class="icon-remove-sign icon-2x"></i>
      <ul class="search-results post-list"></ul> -->
<!-- /.search-results -->
<!-- </div> -->
<!-- /.search-form -->
<!-- </div> -->
<!-- ./search-wrapper -->
<!--  -->

  

  <div class="container-fluid">

  <div class="row">


    <div class="col-md-2"></div>
      <div class="col-md-8">
        

        <div id="main" role="main" class="marginal">
          <article class="entry">

            

            <div>
              <header>
                <span class="entry-tags">
                  
                    <a href="http://localhost:4000/blog/tags/#SSH" title="Pages tagged SSH">SSH</a>
                    &nbsp;&bull;&nbsp;
                  
                    <a href="http://localhost:4000/blog/tags/#SELinux" title="Pages tagged SELinux">SELinux</a>
                    
                  

                  <div class=' social-sharing pull-right'>        
  
    <span class="social-share-facebook">
      <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.elitmus.com/blog/technology/beware-of-creating-ssh-folder-by-hand-when-selinux-is-turned-on/" title="Share on Facebook" itemprop="Facebook"><i class="fa fa-facebook-square fa-lg"></i> Like</a>
    </span>&nbsp;&nbsp;
    <span class="social-share-twitter">
       <a href="https://twitter.com/share?hashtags=technology&text=Beware of creating $HOME/.ssh folder by hand, when SELinux is turned on&via=elitmus" title="Share on Twitter" itemprop="Twitter"><i class="fa fa-twitter-square  fa-lg"></i></i> Tweet</a>
    </span>&nbsp;&nbsp;
     
</div>

                </span>
              
                
                  <h1 class="no-padding">Beware of creating $HOME/.ssh folder by hand, when SELinux is turned on</h1>
                
              </header>
            </div>
           
            <div>
              <div>
                <span class='badge badge-warning'> <a href="/blog/categories/technology/index.html" > technology </a></span>
              </div>

              
                <div class='pull-left date-show'>
                  <span class="entry-date date published">
                    <time datetime="2012-07-22T00:00:00+05:30">
                      <i class="fa fa-calendar"></i> July 22, 2012
                    </time>
                  </span>&nbsp;

                  

                </div>

                <div class='pull-right date-show'>
                  <span>
                    <a href="http://localhost:4000/blog/technology/beware-of-creating-ssh-folder-by-hand-when-selinux-is-turned-on/" rel="bookmark" title="Beware of creating $HOME/.ssh folder by hand, when SELinux is turned on">
                      <i class="fa fa-link"></i> Permalink
                    </a>
                  </span>
                </div>

              <br>
              <div class="panel panel-default">
                <div class="panel-heading ">
                  <h3 class="panel-title">TL;DR</h3>
                </div>
                <div class="panel-body">
                  <aside>If you created $HOME in a non-standard place, and created $HOME/.ssh by hand, SELinux may not like it. To please SELinux, you need to set the right "file context" as described in this post</aside>
                </div>
              </div>
      
            

              <div class="post-content-justify">
                <p>I was experimenting with <code>chef</code> to manage our Linux boxes. As a standard practice, our application user <code>deployer</code> is homed in <code>/applications/deployer</code> rather than the usual <code>/home/deployer</code>.</p>

<p>To enable password less login, I appended my public key to <code>~/.ssh/authorized_keys</code></p>

<pre><code> ssh-copy-id -i ~/.ssh/id_rsa deployer@remote.server
</code></pre>

<p>The first time I run this command, I will be prompted for a password to install my key. After this, I can run the below command to login without a password:</p>

<pre><code>ssh -i ~/.ssh/id_rsa deployer@remote.server
</code></pre>

<p>However, that did not work as expected.</p>

<p>For some reason, <code>sshd</code> was unable to read the <code>authorized_keys</code> file. I checked all the usual things.. all looked fine. Everything seem to work just fine when <code>SELinux</code> was running in <code>permissive</code> mode on the remote server, but not when it was in <code>enforcing</code> mode.</p>

<p>Discovered that if <code>.ssh</code> folder was created by hand (or even the folder containing <code>.ssh</code> folder), we need to do few additional things.</p>

<p><strong>Step 1:</strong></p>

<p>Open this file /etc/selinux/targeted/contexts/files/file_contexts.homedirs and append the following line to the bottom</p>

<pre><code> /applications/deployer/[^/]*/\.ssh(/.*)?     system_u:object_r:ssh_home_t:s0
</code></pre>

<p>Note: remember to adjust the path as per your needs.</p>

<p><strong>Step 2:</strong> run the following command</p>

<pre><code>restorecon -R -v /applications/deployer/.ssh
</code></pre>

<p>Again, remember to adjust the path as per your needs.</p>

<p>Now you are all set!</p>

<pre><code> ssh -i ~/.ssh/id_rsa deployer@remote.server
</code></pre>

<p>should log you in without asking for a password!</p>

              </div>
              <div class="entry-tags">
                <div class=' social-sharing pull-right'>        
  
    <span class="social-share-facebook">
      <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.elitmus.com/blog/technology/beware-of-creating-ssh-folder-by-hand-when-selinux-is-turned-on/" title="Share on Facebook" itemprop="Facebook"><i class="fa fa-facebook-square fa-lg"></i> Like</a>
    </span>&nbsp;&nbsp;
    <span class="social-share-twitter">
       <a href="https://twitter.com/share?hashtags=technology&text=Beware of creating $HOME/.ssh folder by hand, when SELinux is turned on&via=elitmus" title="Share on Twitter" itemprop="Twitter"><i class="fa fa-twitter-square  fa-lg"></i></i> Tweet</a>
    </span>&nbsp;&nbsp;
     
</div>
              </div>
              <div class="clearfix"><br/></div>

                <div class="panel panel-default">

  
    
      <div class="panel-body">
        <div class="container-fluid">

          <div class="row">
            <div class="col-sm-12 col-md-4">
              <center>
                <img src="http://localhost:4000/blog/images/shireeshj.png" alt="Shireesh Jayashetty photo" class="author-photo img-circle img-responsive"/>
                
                <span class="author vcard">
                  <span class="fn">Shireesh Jayashetty</span>
                </span>

                <div class="nav-icon-size-reduce social-icons">
                  
                    <a href="http://twitter.com/shireeshj"  title="Shireesh Jayashetty on Twitter"  target="_blank"><i class="fa fa-twitter "></i></a>
                  
                  
                  
                  

                  
                    <a href="http://linkedin.com/in/shireeshj" title="Shireesh Jayashetty on LinkedIn" target="_blank"><i class="fa fa-linkedin "></i></a>
                  

                  

                  

                  

                  
                    <a href="http://github.com/shireeshj" title="Shireesh Jayashetty on Github" target="_blank"><i class="fa fa-github "></i></a>
                  

                     
                </div><!-- /.social-icons -->
              </center>
            </div>

            <div class="col-sm-12 col-md-8">
              
                <span class="author-bio">Shireesh heads technology at eLitmus. He is generally curious about things, especially technology. His curiosity almost cost him his first job when he hacked into a customer's system to gain unauthorized internet access (mid '90s). He was lucky, his employer saw this as a potential rather than a threat.</span>
              
            </div>

          </div>

        </div>
      </div>

  

  

  

  

  

  

  

  

  

</div>
                <div id='discourse-comments'></div>

<script type="text/javascript">
  DiscourseEmbed = { discourseUrl: 'https://adda.elitmus.com/',
                     discourseEmbedUrl: 'https://www.elitmus.com/blog/technology/beware-of-creating-ssh-folder-by-hand-when-selinux-is-turned-on/'
                   };

  (function() {
    var d = document.createElement('script'); 
    d.type = 'text/javascript'; 
    d.async = true;
    d.src = DiscourseEmbed.discourseUrl + 'javascripts/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
  })();
</script>


                
              </div><!-- /.entry-content -->
            </div><!-- /.entry-wrapper -->

          </article>

          <nav class="navbar nav-justified" role="navigation">
            <ul class="nav pager">
              
                <li class="previous showElem mr-auto"><a href="http://localhost:4000/blog/technology/importance-of-date-field-in-an-emails-header/" title="Importance of Date field in an email's Header">&larr;<span class="showPrevNex"> Previous </span> </a></li>
              
              
                <li class="next showElem ml-auto"><a href="http://localhost:4000/blog/technology/setting-up-amazon-rds-as-a-slave-to-a-self-managed-mysql-server/" title="Setting Up Amazon RDS as a Slave to a self-managed MySQL server"> <span class='showPrevNex'> Next </span> &rarr; </a></li>
              
            </ul>
          </nav>
        
        </div><!-- /#main -->

      <!--/col-md-2 -->
      <div class="col-md-2">

      </div>

    </div><!-- /row -->
    </div>
    <div class="footer-color">
      <footer role="contentinfo">
        <center>
            <span class='footer-text'>
    &copy;  2005-<script> document.write(new Date().getFullYear()) </script>, eLitmus.com. | <a href="/terms_of_use/">Terms of Use</a> &middot; <a href="/privacy_policy/">Privacy Policy</a>

  </span>
        </center>
      </footer>
    </div><!-- /.footer-wrapper -->
    

	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-707704-1', 'elitmus.com');
	  ga('send', 'pageview');
	</script>



<!-- Load Modernizr -->
<script src="http://localhost:4000/blog/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- adding jquery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- end of jquery -->

<script src="http://localhost:4000/blog/assets/js/scripts.min.js"></script>
<script src="http://localhost:4000/blog/assets/js/lunr.min.js"></script>
<script src="http://localhost:4000/blog/assets/js/plugins/headroom.min.js"></script>
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
<script src="http://localhost:4000/blog/assets/js/vendor/forkit.js"></script>
  

  </body>
</html>
