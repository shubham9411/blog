<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Setting Up Amazon RDS as a Slave to a self-managed MySQL server &#8211; eLitmus Blog</title>
<meta name="description" content="We learn new things everyday, and we document our learnings here...">

<meta name="keywords" content="mysql, RDS, AWS, replication">

<!-- Twitter Cards -->
  <meta name="twitter:card" content="summary">    
<meta name="twitter:title" content="Setting Up Amazon RDS as a Slave to a self-managed MySQL server">
<meta name="twitter:description" content=" The master user of RDS has curtailed permissions and is not allowed to run several commands, including those required to configure a slave">
<meta name="twitter:site" content="@elitmus">

    
        
            <meta name="twitter:creator" content="@shireeshj">
        
    

    

    

    

    

    

    

    

    




<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:image" content="/blog/images/blog_logo_taglinedorange.png"/>
<meta property="og:type" content="article">
<meta property="og:title" content="Setting Up Amazon RDS as a Slave to a self-managed MySQL server">
<meta property="og:description" content="The master user of RDS has curtailed permissions and is not allowed to run several commands, including those required to configure a slave">
<meta property="og:url" content="/blog/technology/setting-up-amazon-rds-as-a-slave-to-a-self-managed-mysql-server/">

<meta property="og:site_name" content="eLitmus Blog">







<link rel="canonical" href="https://www.elitmus.com/blog/technology/setting-up-amazon-rds-as-a-slave-to-a-self-managed-mysql-server/">
<link href="/blog/feed.xml" type="application/atom+xml" rel="alternate" title="eLitmus Blog Feed">


	<link rel="author" href="https://plus.google.com/+eLitmus?rel=author">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Icons -->
<!-- apple touch icons -->
<link rel="apple-touch-icon" sizes="57x57" href="/blog/images/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="114x114" href="/blog/images/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/blog/images/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="144x144" href="/blog/images/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="60x60" href="/blog/images/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="120x120" href="/blog/images/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="76x76" href="/blog/images/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="152x152" href="/blog/images/apple-touch-icon-152x152.png">
<!-- Favicons default 16x16 -->
<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="/blog/favicon.ico">

<!-- Favicons others -->
<link rel="icon" type="image/png" href="/blog/images/favicon-196x196.png" sizes="196x196">
<link rel="icon" type="image/png" href="/blog/images/favicon-160x160.png" sizes="160x160">
<link rel="icon" type="image/png" href="/blog/images/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/blog/images/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/blog/images/favicon-32x32.png" sizes="32x32">

<!-- Icons for Windows 8 Tiles -->
<meta name="msapplication-TileColor" content="#ffffff"/>
<meta name="msapplication-TileImage" content="/blog/images/mstile-144x144.png">

<!-- For all browsers -->


<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:600,300,300italic|The+Girl+Next+Door" rel="stylesheet" type="text/css">
<link href='//fonts.googleapis.com/css?family=Source+Code+Pro:300' rel='stylesheet' type='text/css'>

<meta http-equiv="cleartype" content="on">

<!-- bootstrap 4 -->
<link rel="stylesheet" type="text/css" href="/blog/assets/css/bootstrap.min.css">

<!-- below css file is used for navbar in individual blogposts -->
<link rel="stylesheet" type="text/css" href="/blog/assets/css/main.min.css">

<!-- <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css"> -->

<!-- Optional theme -->
<link rel="stylesheet" type="text/css" href="/blog/assets/css/bootstrap-theme.min.css">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Font Awesome -->
<link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="/blog/assets/css/font-elitmuslogo.css" />

<link rel="stylesheet" href="/blog/assets/css/customize.css">
<link rel="stylesheet" href="/blog/assets/css/forkit.css">
</head>

<body id="post">

  <header class="headroom">

	<nav class="navbar navbar-expand-md navbar-dark bg-black fixed-top" role="navigation">

			<a class="navbar-brand" href="/blog/">
				<img src="https://cdn0.elitmus.net/assets/elitmus-only-logo-6efc8a74032179afdb89829a093e05bd05d627dd4354bbd1ff7f4eb5db8a0af8.svg" class="img-logo">
				<span><div class="blog-label">blog</div></span>
			</a>

			<!-- the toggle button -->
			<button type="button" class="navbar-toggler" data-toggle="collapse" data-target=".navbar-collapse">
				<span class="navbar-toggler-icon"></span>
				<span class="sr-only">Toggle navigation</span><!-- only for screen readers -->
			</button>

			<div class="collapse navbar-collapse">
				<ul class="nav navbar-nav mr-auto">

					<!-- first item = dropdown search -->
					<li class="nav-item">
						<div class="dropdown search-box-margin">

						<!--
							<div class="form-inline">
								 

								<input data-toggle="dropdown" placeholder="Search..." id="search-box" class="form-control form-control-sm search-input dropdown-toggle" aria-haspopup="true" aria-expanded="false">


								<div class="dropdown-menu" id="search-dropdown">
	                  				<a role='presentation' class='dropdown-item search-results'> Type more.... </a>
								</div>
							</div>
						-->
            

						<!-- the below line will pass "search word" to search.html -->

						<!--
						<form class="form-inline" action="/blog/search" method="get">
							 


							<label for="search_box">Search</label>
							<input data-toggle="dropdown" type="text" name="query" placeholder="Search..." id="search-box" class="form-control form-control-sm search-input dropdown-toggle" aria-haspopup="true" aria-expanded="false">

							<div class="dropdown-menu" id="search-dropdown">
                  				<a role='presentation' class='dropdown-item search-results'> Type more.... </a>
							</div>

							<input type="submit" value="search">

						</form>
						-->

						<!-- end of form -->


						</div>
					</li>
				</ul>

				

				<!-- every link on the right side -->
				<ul class="nav navbar-nav navbar-right nav-icon-size-reduce">
					
					<li class="nav-item">
						 
							<a href="/blog/" class="nav-link">
								<i class="fa fa-home"></i> Home
							</a>
						
					</li>
					
					<li class="nav-item">
						 
							<a href="/blog/posts/" class="nav-link">
								<i class="fa fa-file-text-o"></i> Posts
							</a>
						
					</li>
					
					<li class="nav-item">
						 
							<a href="//www.elitmus.com/" class="nav-link">
								<i class="el el-elitmuslogo"></i> eLitmus
							</a>
						
					</li>
					

					<!-- feed is the last link -->
					<li class="nav-item">
						<a href="/blog/feed.xml" class="nav-link" title="Atom/RSS feed">
							<i class="fa fa-rss"></i> Feed
						</a>
					</li>
				</ul>



			</div> <!-- /.navbar-collapse -->

		<!-- -------- -->
	</nav><!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
</header>
<!-- 

  <div class="search-wrapper">
    <div class="search-form">
      <input type="text" class="search-field" placeholder="Search...">
      <i class="icon-remove-sign icon-2x"></i>
      <ul class="search-results post-list"></ul> -->
<!-- /.search-results -->
<!-- </div> -->
<!-- /.search-form -->
<!-- </div> -->
<!-- ./search-wrapper -->
<!--  -->

  

  <div class="container-fluid">

  <div class="row">


    <div class="col-md-2"></div>
      <div class="col-md-8">
        

        <div id="main" role="main" class="marginal">
          <article class="entry">

            

            <div>
              <header>
                <span class="entry-tags">
                  
                    <a href="/blog/tags/#mysql" title="Pages tagged mysql">mysql</a>
                    &nbsp;&bull;&nbsp;
                  
                    <a href="/blog/tags/#RDS" title="Pages tagged RDS">RDS</a>
                    &nbsp;&bull;&nbsp;
                  
                    <a href="/blog/tags/#AWS" title="Pages tagged AWS">AWS</a>
                    &nbsp;&bull;&nbsp;
                  
                    <a href="/blog/tags/#replication" title="Pages tagged replication">replication</a>
                    
                  

                  <div class=' social-sharing pull-right'>        
  
    <span class="social-share-facebook">
      <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.elitmus.com/blog/technology/setting-up-amazon-rds-as-a-slave-to-a-self-managed-mysql-server/" title="Share on Facebook" itemprop="Facebook"><i class="fa fa-facebook-square fa-lg"></i> Like</a>
    </span>&nbsp;&nbsp;
    <span class="social-share-twitter">
       <a href="https://twitter.com/share?hashtags=technology&text=Setting Up Amazon RDS as a Slave to a self-managed MySQL server&via=elitmus" title="Share on Twitter" itemprop="Twitter"><i class="fa fa-twitter-square  fa-lg"></i></i> Tweet</a>
    </span>&nbsp;&nbsp;
     
</div>

                </span>
              
                
                  <h1 class="no-padding">Setting Up Amazon RDS as a Slave to a self-managed MySQL server</h1>
                
              </header>
            </div>
           
            <div>
              <div>
                <span class='badge badge-warning'> <a href="/blog/categories/technology/index.html" > technology </a></span>
              </div>

              
                <div class='pull-left date-show'>
                  <span class="entry-date date published">
                    <time datetime="2014-05-21T00:00:00+05:30">
                      <i class="fa fa-calendar"></i> May 21, 2014
                    </time>
                  </span>&nbsp;

                  

                </div>

                <div class='pull-right date-show'>
                  <span>
                    <a href="/blog/technology/setting-up-amazon-rds-as-a-slave-to-a-self-managed-mysql-server/" rel="bookmark" title="Setting Up Amazon RDS as a Slave to a self-managed MySQL server">
                      <i class="fa fa-link"></i> Permalink
                    </a>
                  </span>
                </div>

              <br>
              <div class="panel panel-default">
                <div class="panel-heading ">
                  <h3 class="panel-title">TL;DR</h3>
                </div>
                <div class="panel-body">
                  <aside>The master user of RDS has curtailed permissions and is not allowed to run several commands, including those required to configure a slave</aside>
                </div>
              </div>
      
            

              <div class="post-content-justify">
                <p>Last week, we migrated our MySQL database server, which was running on an EC2 instance, to RDS. We hoped the migration process would be smooth.</p>

<p>As always, migrating a large database has its challenges. Business folks expect the minimum possible downtime.</p>

<p>The plan was simple.</p>

<ol>
  <li>Launch an RDS instance</li>
  <li>Load a full dump into it</li>
  <li>Configure it to act as a slave of the self-managed server (current master)</li>
  <li>On the D-day, pull the website down and promote the RDS instance to take over as the new master</li>
</ol>

<p>We soon discovered that RDS comes with curtailed root permissions. There are several commands that are disallowed. Some of these include “CHANGE MASTER TO….”</p>

<p>What do we do now?</p>

<p>One option was to carry out the migration in one go, while the website was offline. This meant the downtime would have been several hours, instead of minutes. Obviously, not an acceptable option at all.</p>

<p>Some R&amp;D was all it took to discover how to proceed with the original approach.</p>

<p>RDS comes with a bunch of stored procedures, which help you configure it as a slave. There is almost a one-to-one mapping of these stored procedures with the commands that are disallowed.</p>

<table class="table table-bordered table-condensed table-hover">
<tr><th>MySQL Command</th><th>Corrosponding Stored Proc</th></tr>
<tr><td>CHANGE MASTER TO</td><td>mysql.rds_set_external_master</td></tr>
<tr><td>START SLAVE</td><td>mysql.rds_start_replication</td></tr>
<tr><td>STOP SLAVE</td><td>mysql.rds_stop_replication</td></tr>
<tr><td>RESET MASTER</td><td>mysql.rds_reset_external_master </td></tr>
</table>

<p>So, Using these stored procedures, you can now configure your RDS instance as a slave to your self-managed MySQL server</p>

<p>After loading a full dump to RDS, Call the stored procedure <code>mysql.rds_set_external_master</code> like this</p>

<pre><code>CALL mysql.rds_set_external_master ('servername', port, 'user', 'password', 'binlog-file', binlog-offset, 0);
</code></pre>

<p>Then</p>

<pre><code>CALL mysql.rds_start_replication;
</code></pre>

<p>This will make RDS a slave of your self managed mysql server. You can run “SHOW SLAVE STATUS” to see its working.</p>

<p>When it is time to promote RDS to master. You call these stored procedures</p>

<pre><code>CALL mysql.rds_stop_replication;

CALL mysql.rds_reset_external_master;
</code></pre>

<p>That’s it. Now point your applications to the RDS instance and take your site live.</p>

<p><strong>Note:</strong></p>

<p>For your RDS to work as a slave, it needs permissions to connect to port 3306 of your current master. Make sure you open this port for the RDS instance.</p>

<p>You can run the following command to find out the ip address of your rds instance</p>

<pre><code>ping -c rdsname.cpesx66wwe7y.ap-southeast-1.rds.amazonaws.com
</code></pre>

              </div>
              <div class="entry-tags">
                <div class=' social-sharing pull-right'>        
  
    <span class="social-share-facebook">
      <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.elitmus.com/blog/technology/setting-up-amazon-rds-as-a-slave-to-a-self-managed-mysql-server/" title="Share on Facebook" itemprop="Facebook"><i class="fa fa-facebook-square fa-lg"></i> Like</a>
    </span>&nbsp;&nbsp;
    <span class="social-share-twitter">
       <a href="https://twitter.com/share?hashtags=technology&text=Setting Up Amazon RDS as a Slave to a self-managed MySQL server&via=elitmus" title="Share on Twitter" itemprop="Twitter"><i class="fa fa-twitter-square  fa-lg"></i></i> Tweet</a>
    </span>&nbsp;&nbsp;
     
</div>
              </div>
              <div class="clearfix"><br/></div>

                <div class="panel panel-default">

  
    
      <div class="panel-body">
        <div class="container-fluid">
          <div class="row">
            <div class="col-xs-6 col-md-4">
              <center>
                <img src="/blog/images/shireeshj.png" alt="Shireesh Jayashetty photo" class="author-photo img-circle img-responsive"/>
                <span class="author vcard"><span class="fn">Shireesh Jayashetty</span></span>

                <div class="nav-icon-size-reduce social-icons">
                  
                    <a href="http://twitter.com/shireeshj"  title="Shireesh Jayashetty on Twitter"  target="_blank"><i class="fa fa-twitter "></i></a>
                  
                  
                  
                  

                  
                    <a href="http://linkedin.com/in/shireeshj" title="Shireesh Jayashetty on LinkedIn" target="_blank"><i class="fa fa-linkedin "></i></a>
                  

                  

                  

                  

                  
                    <a href="http://github.com/shireeshj" title="Shireesh Jayashetty on Github" target="_blank"><i class="fa fa-github "></i></a>
                  

                     
                </div><!-- /.social-icons -->
              </center>
            </div>

            <!-- Add the extra clearfix for only the required viewport -->
            <div class="clearfix visible-xs"></div>

            <div class="col-md-8">
              
                <span class="author-bio">Shireesh heads technology at eLitmus. He is generally curious about things, especially technology. His curiosity almost cost him his first job when he hacked into a customer's system to gain unauthorized internet access (mid '90s). He was lucky, his employer saw this as a potential rather than a threat.</span>
              
            </div>
          </div>
        </div>
      </div>

  

  

  

  

  

  

  

  

  

</div>
                <div id='discourse-comments'></div>

<script type="text/javascript">
  DiscourseEmbed = { discourseUrl: 'https://adda.elitmus.com/',
                     discourseEmbedUrl: 'https://www.elitmus.com/blog/technology/setting-up-amazon-rds-as-a-slave-to-a-self-managed-mysql-server/'
                   };

  (function() {
    var d = document.createElement('script'); 
    d.type = 'text/javascript'; 
    d.async = true;
    d.src = DiscourseEmbed.discourseUrl + 'javascripts/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
  })();
</script>


                
              </div><!-- /.entry-content -->
            </div><!-- /.entry-wrapper -->

          </article>

          <nav class="navbar nav-justified" role="navigation">
            <ul class="nav pager">
              
                <li class="previous showElem mr-auto"><a href="/blog/technology/beware-of-creating-ssh-folder-by-hand-when-selinux-is-turned-on/" title="Beware of creating $HOME/.ssh folder by hand, when SELinux is turned on">&larr;<span class="showPrevNex"> Previous </span> </a></li>
              
              
                <li class="next showElem ml-auto"><a href="/blog/technology/gotchas-while-syntactically-translating-aes-encryption-logic-from-php-to-ruby/" title="Gotcha's while syntactically translating AES encryption logic from PHP to Ruby"> <span class='showPrevNex'> Next </span> &rarr; </a></li>
              
            </ul>
          </nav>
        
        </div><!-- /#main -->

      <!--/col-md-2 -->
      <div class="col-md-2">

      </div>

    </div><!-- /row -->
    </div>
    <div class="footer-color">
      <footer role="contentinfo">
        <center>
            <span class='footer-text'>
    &copy;  2005-<script> document.write(new Date().getFullYear()) </script>, eLitmus.com. | <a href="/terms_of_use/">Terms of Use</a> &middot; <a href="/privacy_policy/">Privacy Policy</a>

  </span>
        </center>
      </footer>
    </div><!-- /.footer-wrapper -->
    

	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-707704-1', 'elitmus.com');
	  ga('send', 'pageview');
	</script>



<!-- Load Modernizr -->
<script src="/blog/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- adding jquery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- end of jquery -->

<script src="/blog/assets/js/scripts.min.js"></script>
<script src="/blog/assets/js/lunr.min.js"></script>
<script src="/blog/assets/js/plugins/headroom.min.js"></script>
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
<script src="/blog/assets/js/vendor/forkit.js"></script>
  

  </body>
</html>
